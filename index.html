<!-- index.html 部分 -->
    ...
    <div class="results" id="results">
        <!-- ... 保持不變 ... -->
    </div>
  </div>

  <!-- 引入外部題庫 -->
  <script src="quiz.js"></script>
  <script>
    // 遊戲狀態
    let gameState = {
        selectedGrade: null,
        selectedTime: null,
        currentQuestions: [],
        currentQuestionIndex: 0,
        score: 0,
        timeLeft: 0,
        timer: null,
        userAnswers: [],
        gameStarted: false
    };

    // 初始化遊戲
    function initGame() {
        document.querySelectorAll('.grade-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.grade-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                gameState.selectedGrade = btn.dataset.grade;
            });
        });
        document.querySelectorAll('.time-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                gameState.selectedTime = parseInt(btn.dataset.time);
            });
        });
        document.getElementById('startGame').addEventListener('click', startGame);
        document.getElementById('nextBtn').addEventListener('click', nextQuestion);
        document.getElementById('restartBtn').addEventListener('click', restartGame);
    }

    function startGame() {
        if (!gameState.selectedGrade || !gameState.selectedTime) {
            alert('請選擇年級程度和挑戰時間！');
            return;
        }
        prepareQuestions();
        gameState.currentQuestionIndex = 0;
        gameState.score = 0;
        gameState.timeLeft = gameState.selectedTime;
        gameState.userAnswers = [];
        gameState.gameStarted = true;
        document.getElementById('setup').style.display = 'none';
        document.getElementById('gameArea').style.display = 'block';
        startTimer();
        showQuestion();
    }

    function prepareQuestions() {
        // 這裡會使用 quiz.js 提供的題庫
        const gradeData = questionBank[gameState.selectedGrade];
        const soundQuestions = [...gradeData.sound];
        const shapeQuestions = [...gradeData.shape];
        const selectedSound = getRandomQuestions(soundQuestions, 10);
        const selectedShape = getRandomQuestions(shapeQuestions, 10);
        gameState.currentQuestions = shuffleArray([...selectedSound, ...selectedShape]);
        distributeCorrectAnswers();
    }

    // ... 其他函數 (getRandomQuestions, shuffleArray, distributeCorrectAnswers, showQuestion, selectAnswer, nextQuestion, endGame, showDetailedResults, restartGame) 全部保留不變 ...

    initGame();
  </script>
</body>
</html>
