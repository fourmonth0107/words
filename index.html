<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—éŸ³å­—å½¢äº’å‹•å°éŠæˆ²</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .content {
            padding: 30px;
        }

        .setup-screen {
            text-align: center;
        }

        .option-group {
            margin: 30px 0;
        }

        .option-group h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .option-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .option-btn {
            padding: 12px 24px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .option-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .start-btn {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s ease;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .game-screen {
            display: none;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6b6b;
        }

        .progress {
            font-size: 1.2rem;
            color: #667eea;
        }

        .question-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .question-type {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: #333;
        }

        .answers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .answer-btn {
            padding: 15px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .answer-btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }

        .answer-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .next-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .next-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .result-screen {
            display: none;
            text-align: center;
        }

        .score-display {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .score-display h2 {
            margin: 0 0 10px 0;
            font-size: 2rem;
        }

        .score-display p {
            margin: 5px 0;
            font-size: 1.2rem;
        }

        .review-section {
            text-align: left;
            margin-top: 30px;
        }

        .review-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .review-item.wrong {
            border-left-color: #dc3545;
        }

        .restart-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        @media (max-width: 600px) {
            .option-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .answers {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: 1fr 1fr;
            }
            
            .game-header {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å­—éŸ³å­—å½¢äº’å‹•å°éŠæˆ²</h1>
        </div>
        
        <div class="content">
            <!-- è¨­å®šç•«é¢ -->
            <div class="setup-screen" id="setupScreen">
                <div class="option-group">
                    <h3>é¸æ“‡å¹´ç´šç¨‹åº¦</h3>
                    <div class="option-buttons">
                        <button class="option-btn" data-grade="low">ä½å¹´ç´š (1-2å¹´ç´š)</button>
                        <button class="option-btn" data-grade="mid">ä¸­å¹´ç´š (3-4å¹´ç´š)</button>
                        <button class="option-btn" data-grade="high">é«˜å¹´ç´š (5-6å¹´ç´š)</button>
                    </div>
                </div>
                
                <div class="option-group">
                    <h3>é¸æ“‡æŒ‘æˆ°æ™‚é–“</h3>
                    <div class="option-buttons">
                        <button class="option-btn" data-time="120">2åˆ†é˜ âš¡</button>
                        <button class="option-btn" data-time="180">3åˆ†é˜ ğŸƒ</button>
                        <button class="option-btn" data-time="300">5åˆ†é˜ ğŸš¶</button>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startGame()">é–‹å§‹éŠæˆ² ğŸš€</button>
            </div>
            
            <!-- éŠæˆ²ç•«é¢ -->
            <div class="game-screen" id="gameScreen">
                <div class="game-header">
                    <div class="timer" id="timer">â° 5:00</div>
                    <div class="progress" id="progress">ç¬¬ 1 é¡Œ / 20 é¡Œ</div>
                </div>
                
                <div class="question-card">
                    <div class="question-type" id="questionType">å­—éŸ³é¡Œ</div>
                    <div class="question-text" id="questionText">è«‹é¸æ“‡æ­£ç¢ºçš„è®€éŸ³</div>
                    <div class="answers" id="answers"></div>
                    <button class="next-btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">ä¸‹ä¸€é¡Œ</button>
                </div>
            </div>
            
            <!-- çµæœç•«é¢ -->
            <div class="result-screen" id="resultScreen">
                <div class="score-display">
                    <h2>ğŸ‰ éŠæˆ²çµæŸï¼</h2>
                    <p id="finalScore">ç¸½åˆ†ï¼š0 / 20</p>
                    <p id="accuracy">æ­£ç¢ºç‡ï¼š0%</p>
                    <p id="timeUsed">ç”¨æ™‚ï¼š0åˆ†0ç§’</p>
                </div>
                
                <div class="review-section">
                    <h3>ğŸ“ é¡Œç›®å›é¡§</h3>
                    <div id="reviewList"></div>
                </div>
                
                <button class="restart-btn" onclick="restartGame()">é‡æ–°é–‹å§‹</button>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            grade: '',
            timeLimit: 0,
            currentQuestion: 0,
            score: 0,
            questions: [],
            userAnswers: [],
            startTime: 0,
            timer: null
        };

        // é¡Œåº«
        const questionBank = {
            low: {
                pronunciation: [
                    {question: 'ã€Œå¤§ã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„‰ã„Ë‹', 'ã„‰ã„šË‹', 'ã„Šã„šË‹', 'ã„‰ã„š'], correct: 1},
                    {question: 'ã€Œå°ã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„’ã„§ã„ ', 'ã„’ã„§ã„ Ë‹', 'ã„’ã„§ã„ Ë‡', 'ã„’ã„§ã„ ËŠ'], correct: 2},
                    {question: 'ã€Œæ°´ã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„•ã„¨ã„Ÿ', 'ã„•ã„¨ã„ŸË‹', 'ã„•ã„¨ã„ŸËŠ', 'ã„•ã„¨ã„ŸË‡'], correct: 3},
                    {question: 'ã€Œç«ã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„ã„¨ã„›Ë‡', 'ã„ã„¨ã„›', 'ã„ã„¨ã„›Ë‹', 'ã„ã„¨ã„›ËŠ'], correct: 0},
                    {question: 'ã€Œå±±ã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„™ã„¢', 'ã„•ã„¢', 'ã„•ã„¢ËŠ', 'ã„•ã„¢Ë‡'], correct: 1},
                    {question: 'ã€Œäººã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„–ã„£', 'ã„–ã„£Ë‡', 'ã„–ã„£ËŠ', 'ã„–ã„£Ë‹'], correct: 2},
                    {question: 'ã€Œæ‰‹ã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„•ã„¡', 'ã„•ã„¡Ë‹', 'ã„•ã„¡ËŠ', 'ã„•ã„¡Ë‡'], correct: 3},
                    {question: 'ã€Œå£ã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„ã„¡Ë‡', 'ã„ã„¡', 'ã„ã„¡Ë‹', 'ã„ã„¡ËŠ'], correct: 0},
                    {question: 'ã€Œå¿ƒã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„’ã„§ã„£ËŠ', 'ã„’ã„§ã„£', 'ã„’ã„§ã„£Ë‡', 'ã„’ã„§ã„£Ë‹'], correct: 1},
                    {question: 'ã€Œæ—¥ã€çš„æ­£ç¢ºè®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„–', 'ã„–ËŠ', 'ã„–Ë‹', 'ã„–Ë‡'], correct: 2}
                ],
                glyph: [
                    {question: 'ã€Œã„‰ã„šË‹ã€æ¨¹', options: ['å¤ª', 'å¤§', 'çŠ¬', 'å¤«'], correct: 1},
                    {question: 'ã€Œã„‡ã„¨Ë‹ã€é ­', options: ['æœ©', 'æœ¯', 'æœ¨', 'æœª'], correct: 2},
                    {question: 'ã€Œã„Šã„§ã„¢ËŠã€åœ°', options: ['ç”±', 'ç”²', 'ç”³', 'ç”°'], correct: 3},
                    {question: 'çœ¼ã€Œã„‡ã„¨Ë‹ã€', options: ['ç›®', 'æ—¥', 'è‡ª', 'ç™½'], correct: 0},
                    {question: 'ã€Œã„¦Ë‡ã€æœµ', options: ['å–', 'è€³', 'è½', 'è·'], correct: 1},
                    {question: 'å°ã€Œã„‹ã„§ã„ Ë‡ã€', options: ['çƒ', 'å³¶', 'é³¥', 'é¦¬'], correct: 2},
                    {question: 'é‡‘ã€Œã„©ËŠã€', options: ['æ¼', 'é±¼', 'æ–¼', 'é­š'], correct: 3},
                    {question: 'ç«ã€Œã„”ã„œã€', options: ['è»Š', 'ä¸œ', 'è»', 'é€£'], correct: 0},
                    {question: 'å¤§ã€Œã„‡ã„£ËŠã€', options: ['é—´', 'é–€', 'å•', 'è'], correct: 1},
                    {question: 'ç™½ã€Œã„‡ã„šË‡ã€', options: ['é³¥', 'å³¶', 'é¦¬', 'çƒ'], correct: 2}
                ]
            },
            mid: {
                pronunciation: [
                    {question: 'ã€Œè™•ç†ã€çš„ã€Œè™•ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„”ã„¨Ë‹', 'ã„”ã„¨Ë‡', 'ã„”ã„¨', 'ã„”ã„¨ËŠ'], correct: 1},
                    {question: 'ã€Œèˆˆè¶£ã€çš„ã€Œèˆˆã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„’ã„§ã„¥', 'ã„’ã„§ã„¥ËŠ', 'ã„’ã„§ã„¥Ë‹', 'ã„’ã„§ã„¥Ë‡'], correct: 2},
                    {question: 'ã€Œå›°é›£ã€çš„ã€Œé›£ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„‹ã„¢Ë‹', 'ã„‹ã„¢', 'ã„‹ã„¢Ë‡', 'ã„‹ã„¢ËŠ'], correct: 3},
                    {question: 'ã€Œæ–¹ä¾¿ã€çš„ã€Œä¾¿ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„…ã„§ã„¢Ë‹', 'ã„†ã„§ã„¢ËŠ', 'ã„…ã„§ã„¢', 'ã„…ã„§ã„¢ËŠ'], correct: 0},
                    {question: 'ã€Œé‡è¦ã€çš„ã€Œé‡ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„”ã„¨ã„¥ËŠ', 'ã„“ã„¨ã„¥Ë‹', 'ã„“ã„¨ã„¥', 'ã„“ã„¨ã„¥ËŠ'], correct: 1},
                    {question: 'ã€Œæ‡‰è©²ã€çš„ã€Œæ‡‰ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„§ã„¥Ë‹', 'ã„§ã„¥ËŠ', 'ã„§ã„¥', 'ã„§ã„¥Ë‡'], correct: 2},
                    {question: 'ã€ŒåƒåŠ ã€çš„ã€Œåƒã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„™ã„¢', 'ã„˜ã„¢ËŠ', 'ã„˜ã„¢Ë‡', 'ã„˜ã„¢'], correct: 3},
                    {question: 'ã€Œç™¼ç¾ã€çš„ã€Œç™¼ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„ˆã„š', 'ã„ˆã„šË‹', 'ã„ˆã„šËŠ', 'ã„ˆã„šË‡'], correct: 0},
                    {question: 'ã€Œæ±ºå®šã€çš„ã€Œæ±ºã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„ã„©ã„', 'ã„ã„©ã„ËŠ', 'ã„ã„©ã„Ë‹', 'ã„ã„©ã„Ë‡'], correct: 1},
                    {question: 'ã€Œç¶“éã€çš„ã€Œç¶“ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„ã„§ã„¥Ë‹', 'ã„ã„§ã„¥ËŠ', 'ã„ã„§ã„¥', 'ã„ã„§ã„¥Ë‡'], correct: 2}
                ],
                glyph: [
                    {question: 'ç¾ã€Œã„—ã„Ë‹ã€å®¶è£¡', options: ['å†', 'åœ¨', 'è¼‰', 'æ ½'], correct: 1},
                    {question: 'ã€Œã„—ã„¨ã„›Ë‹ã€åŠŸèª²', options: ['ä½œ', 'å', 'åš', 'åº§'], correct: 2},
                    {question: 'ã€Œã„’ã„§ã„¤Ë‹ã€ç‰‡', options: ['è±¡', 'ç›¸', 'æƒ³', 'åƒ'], correct: 3},
                    {question: 'ã€Œã„¨ã„¢ËŠã€æˆ', options: ['å®Œ', 'ç©', 'ä¸¸', 'å…ƒ'], correct: 0},
                    {question: 'å…¬ã€Œã„©ã„¢ËŠã€', options: ['åœ“', 'åœ’', 'å…ƒ', 'åŸ'], correct: 1},
                    {question: 'ã€Œã„‡ã„Ë‡ã€æ±è¥¿', options: ['è³£', 'å¯¦', 'è²·', 'è²«'], correct: 2},
                    {question: 'ã€Œã„‘ã„§ã„¥ËŠã€å¤©', options: ['æ¸…', 'æƒ…', 'è«‹', 'æ™´'], correct: 3},
                    {question: 'ã€Œã„†ã„ Ë‡ã€æ­¥', options: ['è·‘', 'æ³¡', 'æŠ±', 'åŒ…'], correct: 0},
                    {question: 'ã€Œã„’ã„§ã„ Ë‹ã€è©±', options: ['æ ¡', 'ç¬‘', 'æ•ˆ', 'å­'], correct: 1},
                    {question: 'ã€Œã„Šã„§ËŠã€ç›®', options: ['æ', 'è¸¢', 'é¡Œ', 'è¹„'], correct: 2}
                ]
            },
            high: {
                pronunciation: [
                    {question: 'ã€Œè¼‰æ­Œè¼‰èˆã€çš„ã€Œè¼‰ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„—ã„Ë‡', 'ã„—ã„Ë‹', 'ã„—ã„', 'ã„—ã„ËŠ'], correct: 1},
                    {question: 'ã€Œä¸€æ›åå¯’ã€çš„ã€Œæ›ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„…ã„ Ë‹', 'ã„†ã„¨', 'ã„†ã„¨Ë‹', 'ã„†ã„¨ËŠ'], correct: 2},
                    {question: 'ã€Œå‰Šè¶³é©å±¥ã€çš„ã€Œå‰Šã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„’ã„§ã„ ', 'ã„’ã„©ã„Ë‹', 'ã„’ã„§ã„ Ë‹', 'ã„’ã„©ã„'], correct: 3},
                    {question: 'ã€Œæ¨¡ç¯„ã€çš„ã€Œæ¨¡ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„‡ã„›ËŠ', 'ã„‡ã„¨ËŠ', 'ã„‡ã„›', 'ã„‡ã„¨'], correct: 0},
                    {question: 'ã€Œè™•å¢ƒã€çš„ã€Œè™•ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„”ã„¨Ë‹', 'ã„”ã„¨Ë‡', 'ã„”ã„¨', 'ã„”ã„¨ËŠ'], correct: 1},
                    {question: 'ã€Œè¡€æ¶²ã€çš„ã€Œè¡€ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„’ã„§ã„Ë‡', 'ã„’ã„©ã„', 'ã„’ã„©ã„Ë‹', 'ã„’ã„§ã„'], correct: 2},
                    {question: 'ã€Œä¾›æ‡‰ã€çš„ã€Œä¾›ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„ã„¨ã„¥Ë‹', 'ã„ã„¨ã„¥ËŠ', 'ã„ã„¨ã„¥Ë‡', 'ã„ã„¨ã„¥'], correct: 3},
                    {question: 'ã€Œèª¿ç¯€ã€çš„ã€Œèª¿ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„Šã„§ã„ ËŠ', 'ã„‰ã„§ã„ Ë‹', 'ã„Šã„§ã„ ', 'ã„Šã„§ã„ Ë‹'], correct: 0},
                    {question: 'ã€Œè–„å¼±ã€çš„ã€Œè–„ã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„…ã„ ËŠ', 'ã„…ã„›ËŠ', 'ã„…ã„›', 'ã„…ã„ '], correct: 1},
                    {question: 'ã€Œå‰µé€ ã€çš„ã€Œå‰µã€å­—è®€éŸ³æ˜¯ï¼Ÿ', options: ['ã„”ã„¨ã„¤', 'ã„”ã„¨ã„¤ËŠ', 'ã„”ã„¨ã„¤Ë‹', 'ã„”ã„¨ã„¤Ë‡'], correct: 2}
                ],
                glyph: [
                    {question: 'ã€Œã„…ã„§ã„¢Ë‹ã€åˆ¥æ˜¯é', options: ['è¾¯', 'è¾¨', 'è¾®', 'ç“£'], correct: 1},
                    {question: 'ã€Œã„ã„§Ë‹ã€ç„¶å¦‚æ­¤', options: ['å³', 'åŠ', 'æ—¢', 'æ€¥'], correct: 2},
                    {question: 'ç¿’ã€Œã„ã„¨ã„¢Ë‹ã€æˆè‡ªç„¶', options: ['è²«', 'ç®¡', 'ç½', 'æ…£'], correct: 3},
                    {question: 'ã€Œã„ã„§ã„¥Ë‹ã€çˆ­æ¿€çƒˆ', options: ['ç«¶', 'ç«Ÿ', 'å¢ƒ', 'é¡'], correct: 0},
                    {question: 'ã€Œã„ã„§ã„¢Ë‡ã€æŸ¥ä½œæ¥­', options: ['æ’¿', 'æª¢', 'æ¸›', 'å„‰'], correct: 1},
                    {question: 'ã€Œã„—ã„¢Ë‹ã€æ™‚åœç•™', options: ['æ¼¸', 'æ…š', 'æš«', 'æ–¬'], correct: 2},
                    {question: 'ã€Œã„†ã„§ã„¥ËŠã€ç©ºæƒ³åƒ', options: ['å‡­', 'å¹³', 'è©•', 'æ†‘'], correct: 3},
                    {question: 'æ‰“ã€Œã„–ã„ Ë‡ã€ç§©åº', options: ['æ“¾', 'é¥’', 'æ’“', 'ç¹'], correct: 0},
                    {question: 'ã€Œã„™ã„¡ã€é›†è³‡æ–™', options: ['æœ', 'è’', 'æ”¶', 'æ‰‹'], correct: 1},
                    {question: 'ã€Œã„”ã„¡ËŠã€å‚™è¨ˆç•«', options: ['æ„', 'ç¨ ', 'ç±Œ', 'ç¶¢'], correct: 2}
                ]
            }
        };

        // é¸é …æŒ‰éˆ•é»æ“Šäº‹ä»¶
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('option-btn')) {
                const group = e.target.parentElement;
                group.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
                e.target.classList.add('selected');
                
                if (e.target.dataset.grade) {
                    gameState.grade = e.target.dataset.grade;
                } else if (e.target.dataset.time) {
                    gameState.timeLimit = parseInt(e.target.dataset.time);
                }
            }
        });

        function startGame() {
            if (!gameState.grade || !gameState.timeLimit) {
                alert('è«‹é¸æ“‡å¹´ç´šç¨‹åº¦å’ŒæŒ‘æˆ°æ™‚é–“ï¼');
                return;
            }

            // æº–å‚™é¡Œç›®
            const bank = questionBank[gameState.grade];
            const pronunciationQuestions = shuffleArray([...bank.pronunciation]).slice(0, 10);
            const glyphQuestions = shuffleArray([...bank.glyph]).slice(0, 10);
            
            gameState.questions = [
                ...pronunciationQuestions.map(q => ({...q, type: 'pronunciation'})),
                ...glyphQuestions.map(q => ({...q, type: 'glyph'}))
            ];
            gameState.questions = shuffleArray(gameState.questions);
            
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.userAnswers = [];
            gameState.startTime = Date.now();

            // åˆ‡æ›ç•«é¢
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';

            // é–‹å§‹è¨ˆæ™‚
            startTimer();
            showQuestion();
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function startTimer() {
            let timeLeft = gameState.timeLimit;
            const timerElement = document.getElementById('timer');
            
            gameState.timer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `â° ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(gameState.timer);
                    endGame();
                    return;
                }
                
                timeLeft--;
            }, 1000);
        }

        function showQuestion() {
            const question = gameState.questions[gameState.currentQuestion];
            
            document.getElementById('questionType').textContent = question.type === 'pronunciation' ? 'å­—éŸ³é¡Œ' : 'å­—å½¢é¡Œ';
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('progress').textContent = `ç¬¬ ${gameState.currentQuestion + 1} é¡Œ / 20 é¡Œ`;
            
            const answersContainer = document.getElementById('answers');
            answersContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                answersContainer.appendChild(button);
            });
            
            document.getElementById('nextBtn').style.display = 'none';
        }

        function selectAnswer(selectedIndex) {
            const question = gameState.questions[gameState.currentQuestion];
            const answerButtons = document.querySelectorAll('.answer-btn');
            
            // æ¸…é™¤ä¹‹å‰çš„é¸æ“‡
            answerButtons.forEach(btn => btn.classList.remove('selected'));
            
            // æ¨™è¨˜é¸æ“‡çš„ç­”æ¡ˆ
            answerButtons[selectedIndex].classList.add('selected');
            
            // è¨˜éŒ„ç­”æ¡ˆ
            gameState.userAnswers[gameState.currentQuestion] = selectedIndex;
            
            // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            
            if (gameState.currentQuestion >= gameState.questions.length) {
                endGame();
            } else {
                showQuestion();
            }
        }

        function endGame() {
            clearInterval(gameState.timer);
            
            // è¨ˆç®—åˆ†æ•¸
            let correctCount = 0;
            gameState.questions.forEach((question, index) => {
                if (gameState.userAnswers[index] === question.correct) {
                    correctCount++;
                }
            });
            
            gameState.score = correctCount;
            const accuracy = Math.round((correctCount / gameState.questions.length) * 100);
            const timeUsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(timeUsed / 60);
            const seconds = timeUsed % 60;
            
            // é¡¯ç¤ºçµæœ
            document.getElementById('finalScore').textContent = `ç¸½åˆ†ï¼š${correctCount} / ${gameState.questions.length}`;
            document.getElementById('accuracy').textContent = `æ­£ç¢ºç‡ï¼š${accuracy}%`;
            document.getElementById('timeUsed').textContent = `ç”¨æ™‚ï¼š${minutes}åˆ†${seconds}ç§’`;
            
            // é¡¯ç¤ºé¡Œç›®å›é¡§
            const reviewList = document.getElementById('reviewList');
            reviewList.innerHTML = '';
            
            gameState.questions.forEach((question, index) => {
                const isCorrect = gameState.userAnswers[index] === question.correct;
                const reviewItem = document.createElement('div');
                reviewItem.className = `review-item ${isCorrect ? '' : 'wrong'}`;
                
                const userAnswer = gameState.userAnswers[index] !== undefined ? 
                    question.options[gameState.userAnswers[index]] : 'æœªä½œç­”';
                const correctAnswer = question.options[question.correct];
                
                reviewItem.innerHTML = `
                    <strong>ç¬¬${index + 1}é¡Œ (${question.type === 'pronunciation' ? 'å­—éŸ³' : 'å­—å½¢'})ï¼š</strong>${question.question}<br>
                    <span style="color: ${isCorrect ? '#28a745' : '#dc3545'};">ä½ çš„ç­”æ¡ˆï¼š${userAnswer}</span><br>
                    <span style="color: #28a745;">æ­£ç¢ºç­”æ¡ˆï¼š${correctAnswer}</span>
                `;
                
                reviewList.appendChild(reviewItem);
            });
            
            // åˆ‡æ›åˆ°çµæœç•«é¢
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';
        }

        function restartGame() {
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            gameState = {
                grade: '',
                timeLimit: 0,
                currentQuestion: 0,
                score: 0,
                questions: [],
                userAnswers: [],
                startTime: 0,
                timer: null
            };
            
            // æ¸…é™¤é¸é …
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
            
            // å›åˆ°è¨­å®šç•«é¢
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9881293215778098',t:'MTc1OTM3NjI0My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
